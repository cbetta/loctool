var ilib=require("./ilib.js");var Utils=require("./Utils.js");var JSUtils=require("./JSUtils.js");var Locale=require("./Locale.js");var LocaleInfo=require("./LocaleInfo.js");var IDate=require("./IDate.js");var CalendarFactory=require("./CalendarFactory.js");var DateFmt=require("./DateFmt.js");var IString=require("./IString.js");var TimeZone=require("./TimeZone.js");var GregorianCal=require("./GregorianCal.js");var DateFactory=require("./DateFactory.js");var DateRngFmt=function(t){var e=true;var a=undefined;this.locale=new Locale;this.length="s";if(t){if(t.locale){this.locale=typeof t.locale==="string"?new Locale(t.locale):t.locale}if(t.calendar){this.calName=t.calendar}if(t.length){if(t.length==="short"||t.length==="medium"||t.length==="long"||t.length==="full"){this.length=t.length.charAt(0)}}if(typeof t.sync!=="undefined"){e=t.sync==true}a=t.loadParams}var i={};JSUtils.shallowCopy(t,i);i.sync=e;i.loadParams=a;i.onLoad=ilib.bind(this,function(e){this.dateFmt=e;if(e){this.locinfo=this.dateFmt.locinfo;this.calName=this.calName||this.locinfo.getCalendar()||"gregorian";this.cal=CalendarFactory({type:this.calName});if(!this.cal){this.cal=new GregorianCal}this.timeTemplate=this.dateFmt._getFormat(this.dateFmt.formats.time[this.dateFmt.clock],this.dateFmt.timeComponents,this.length)||"hh:mm";this.timeTemplateArr=this.dateFmt._tokenize(this.timeTemplate);if(t&&typeof t.onLoad==="function"){t.onLoad(this)}}});new DateFmt(i)};DateRngFmt.prototype={getLocale:function(){return this.locale},getCalendar:function(){return this.dateFmt.getCalendar()},getLength:function(){return DateFmt.lenmap[this.length]||""},getTimeZone:function(){return this.dateFmt.getTimeZone()},getClock:function(){return this.dateFmt.getClock()},format:function(t,e){var a,i,r="",n,s,m,l;var o=this.dateFmt.tz&&this.dateFmt.tz.getId()||"local";var h=DateFactory._dateToIlib(t,o,this.locale);var g=DateFactory._dateToIlib(e,o,this.locale);if(typeof h!=="object"||!h.getCalendar||h.getCalendar()!==this.calName||typeof g!=="object"||!g.getCalendar||g.getCalendar()!==this.calName){throw"Wrong calendar type"}a=h.getRataDie();i=g.getRataDie();if(i-a<3){if(h.year===g.year){if(h.month===g.month){if(h.day===g.day){r=new IString(this.dateFmt._getFormat(this.dateFmt.formats.range,"c00",this.length))}else{r=new IString(this.dateFmt._getFormat(this.dateFmt.formats.range,"c01",this.length))}}else{r=new IString(this.dateFmt._getFormat(this.dateFmt.formats.range,"c02",this.length))}}else{r=new IString(this.dateFmt._getFormat(this.dateFmt.formats.range,"c03",this.length))}}else if(i-a<730){if(h.year===g.year){if(h.month===g.month){r=new IString(this.dateFmt._getFormat(this.dateFmt.formats.range,"c10",this.length))}else{r=new IString(this.dateFmt._getFormat(this.dateFmt.formats.range,"c11",this.length))}}else{r=new IString(this.dateFmt._getFormat(this.dateFmt.formats.range,"c12",this.length))}}else if(i-a<3650){r=new IString(this.dateFmt._getFormat(this.dateFmt.formats.range,"c20",this.length))}else{r=new IString(this.dateFmt._getFormat(this.dateFmt.formats.range,"c30",this.length))}l=this.dateFmt.formats.date;n=this.dateFmt._tokenize(this.dateFmt._getFormatInternal(l,"y",this.length)||"yyyy");s=this.dateFmt._tokenize(this.dateFmt._getFormatInternal(l,"m",this.length)||"MM");m=this.dateFmt._tokenize(this.dateFmt._getFormatInternal(l,"d",this.length)||"dd");return r.format({sy:this.dateFmt._formatTemplate(h,n),sm:this.dateFmt._formatTemplate(h,s),sd:this.dateFmt._formatTemplate(h,m),st:this.dateFmt._formatTemplate(h,this.timeTemplateArr),ey:this.dateFmt._formatTemplate(g,n),em:this.dateFmt._formatTemplate(g,s),ed:this.dateFmt._formatTemplate(g,m),et:this.dateFmt._formatTemplate(g,this.timeTemplateArr)})}};module.exports=DateRngFmt;