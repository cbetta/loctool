var ilib=require("./ilib.js");var Utils=require("./Utils.js");var Locale=require("./Locale.js");var IString=require("./IString.js");var Name=require("./Name.js");var CType=require("./CType.js");var isPunct=require("./isPunct.js");var NameFmt=function(e){var i=true;this.style="short";this.loadParams={};if(e){if(e.locale){this.locale=typeof e.locale==="string"?new Locale(e.locale):e.locale}if(e.style){this.style=e.style}if(e.components){this.components=e.components}if(typeof e.sync!=="undefined"){i=e.sync==true}if(typeof e.loadParams!=="undefined"){this.loadParams=e.loadParams}}this.defaultEuroTemplate=new IString("{prefix} {givenName} {middleName} {familyName}{suffix}");this.defaultAsianTemplate=new IString("{prefix}{familyName}{givenName}{middleName}{suffix}");this.useFirstFamilyName=false;switch(this.style){default:case"s":case"short":this.style="short";break;case"m":case"medium":this.style="medium";break;case"l":case"long":this.style="long";break;case"f":case"full":this.style="full";break;case"fs":case"formal_short":this.style="formal_short";break;case"fl":case"formal_long":this.style="formal_long";break}this.locale=this.locale||new Locale;isPunct._init(i,this.loadParams,ilib.bind(this,function(){Utils.loadData({object:"Name",locale:this.locale,name:"name.json",sync:i,loadParams:this.loadParams,callback:ilib.bind(this,function(i){if(!i){i=Name.defaultInfo;var s=this.locale.getSpec().replace(/-/g,"_");ilib.data.cache.Name[s]=i}this.info=i;this._init();if(e&&typeof e.onLoad==="function"){e.onLoad(this)}})})}))};NameFmt.prototype={_init:function(){var e;this.comps={};if(this.components){var i={p:1,g:1,m:1,f:1,s:1,h:1};e=this.components.split("");this.comps={};for(var s=0;s<e.length;s++){if(i[e[s].toLowerCase()]){this.comps[e[s].toLowerCase()]=true}}}else{var t=this.info.components[this.style];if(typeof t==="string"){t.split("").forEach(ilib.bind(this,function(e){this.comps[e]=true}))}else{this.comps=t}}this.template=new IString(this.info.format);if(this.locale.language==="es"&&(this.style!=="long"&&this.style!=="full")){this.useFirstFamilyName=true}this.isAsianLocale=this.info.nameStyle==="asian"},_adjoinAuxillaries:function(e,i){var s,t,a,l,o;if(this.info.auxillaries&&(e.length>2||i)){for(s=0;s<e.length-1;s++){for(t=e.length;t>s;t--){a=e.slice(s,t);l=a.join(" ");o=l.toLowerCase();o=o.replace(/[,\.]/g,"");if(o in this.info.auxillaries){e.splice(s,t+1-s,a.concat(e[t]));t=s}}}}return e},getLocale:function(){return this.locale},getStyle:function(){return this.style},getComponents:function(){return this.components},format:function(e){var i,s,t,a;var l=this.locale.getLanguage();if(!e||typeof e!=="object"){return undefined}if(!(e instanceof Name)){e=new Name(e,{locale:this.locale})}if(typeof e.isAsianName==="boolean"&&!e.isAsianName||Name._isEuroName([e.givenName,e.middleName,e.familyName].join(""),l)){a=false;t=e.clone();if(t.suffix&&isPunct(t.suffix.charAt(0))===false){t.suffix=" "+t.suffix}if(this.useFirstFamilyName&&e.familyName){var o=t.familyName.trim().split(" ");if(o.length>1){o=this._adjoinAuxillaries(o,e.prefix)}t.familyName=o[0]}t._joinNameArrays()}else{a=true;t=e}if(!this.template||a!==this.isAsianLocale){s=a?this.defaultAsianTemplate:this.defaultEuroTemplate}else{s=this.template}if(t.honorific){if((this.order==="fg"||a)&&l!=="ko"){if(!t.suffix){t.suffix=t.honorific}}else{if(!t.prefix){t.prefix=t.honorific}}}var n={prefix:this.comps["p"]&&t.prefix||"",givenName:this.comps["g"]&&t.givenName||"",middleName:this.comps["m"]&&t.middleName||"",familyName:this.comps["f"]&&t.familyName||"",suffix:this.comps["s"]&&t.suffix||""};i=s.format(n);return i.replace(/\s+/g," ").trim()}};module.exports=NameFmt;