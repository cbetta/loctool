var ilib=require("./ilib.js");var Locale=require("./Locale.js");var JSUtils=require("./JSUtils.js");var Utils={};Utils.mergeLocData=function(i,e,a,t){var l=undefined;var n=e||new Locale;var g=false;var r=i;var f;l=ilib.data[i]||{};f=l;if(n.getLanguage()){r=i+"_"+n.getLanguage();if(ilib.data[r]){g=true;l=JSUtils.merge(l,ilib.data[r],a);f=ilib.data[r]}}if(n.getRegion()){r=i+"_"+n.getRegion();if(ilib.data[r]){g=true;l=JSUtils.merge(l,ilib.data[r],a);f=ilib.data[r]}}if(n.getLanguage()){r=i+"_"+n.getLanguage();if(n.getScript()){r=i+"_"+n.getLanguage()+"_"+n.getScript();if(ilib.data[r]){g=true;l=JSUtils.merge(l,ilib.data[r],a);f=ilib.data[r]}}if(n.getRegion()){r=i+"_"+n.getLanguage()+"_"+n.getRegion();if(ilib.data[r]){g=true;l=JSUtils.merge(l,ilib.data[r],a);f=ilib.data[r]}}}if(n.getRegion()&&n.getVariant()){r=i+"_"+n.getLanguage()+"_"+n.getVariant();if(ilib.data[r]){g=true;l=JSUtils.merge(l,ilib.data[r],a);f=ilib.data[r]}}if(n.getLanguage()&&n.getScript()&&n.getRegion()){r=i+"_"+n.getLanguage()+"_"+n.getScript()+"_"+n.getRegion();if(ilib.data[r]){g=true;l=JSUtils.merge(l,ilib.data[r],a);f=ilib.data[r]}}if(n.getLanguage()&&n.getRegion()&&n.getVariant()){r=i+"_"+n.getLanguage()+"_"+n.getRegion()+"_"+n.getVariant();if(ilib.data[r]){g=true;l=JSUtils.merge(l,ilib.data[r],a);f=ilib.data[r]}}if(n.getLanguage()&&n.getScript()&&n.getRegion()&&n.getVariant()){r=i+"_"+n.getLanguage()+"_"+n.getScript()+"_"+n.getRegion()+"_"+n.getVariant();if(ilib.data[r]){g=true;l=JSUtils.merge(l,ilib.data[r],a);f=ilib.data[r]}}return g?t?f:l:undefined};Utils.getLocFiles=function(i,e){var a="";var t=[];var l=e||"resources.json";var n=i||new Locale;var g=n.getLanguage();var r=n.getRegion();var f=n.getScript();var o=n.getVariant();t.push(l);if(g){a=g+"/";t.push(a+l)}if(r){a="und/"+r+"/";t.push(a+l)}if(g){if(f){a=g+"/"+f+"/";t.push(a+l)}if(r){a=g+"/"+r+"/";t.push(a+l)}}if(r&&o){a="und/"+r+"/"+o+"/";t.push(a+l)}if(g&&f&&r){a=g+"/"+f+"/"+r+"/";t.push(a+l)}if(g&&r&&o){a=g+"/"+r+"/"+o+"/";t.push(a+l)}if(g&&f&&r&&o){a=g+"/"+f+"/"+r+"/"+o+"/";t.push(a+l)}return t};Utils._callLoadData=function(i,e,a,t){if(typeof ilib._load==="function"){return ilib._load(i,e,a,t)}else if(typeof ilib._load==="object"&&typeof ilib._load.loadFiles==="function"){return ilib._load.loadFiles(i,e,a,t)}return undefined};Utils.loadData=function(i){var e="resources.json",a="generic",t=new Locale(ilib.getLocale()),l=false,n=undefined,g={},r=undefined,f=false,o=false,d;if(!i||typeof i.callback!=="function"){return}if(i.name){e=i.name}if(i.object){a=i.object}if(i.locale){t=typeof i.locale==="string"?new Locale(i.locale):i.locale}if(i.type){n=i.type}if(i.loadParams){g=i.loadParams}if(i.sync){l=i.sync}if(i.nonlocale){f=!!i.nonlocale}if(typeof i.replace==="boolean"){o=i.replace}r=i.callback;if(a&&!ilib.data.cache[a]){ilib.data.cache[a]={}}if(!n){var c=e.lastIndexOf(".");n=c!==-1?e.substring(c+1):"text"}var s=(!f&&t.getSpec().replace(/-/g,"_")||"root")+","+e+","+String(JSUtils.hashCode(g));if(!a||!ilib.data.cache[a]||typeof ilib.data.cache[a][s]==="undefined"){var u,b=g&&g.returnOne;if(n==="json"){d=e.substring(0,e.lastIndexOf("."));if(f){d=d.replace(/[\.:\(\)\/\\\+\-]/g,"_");u=ilib.data[d]}else{u=Utils.mergeLocData(d,t,o,b)}if(u){if(a){ilib.data.cache[a][s]=u}r(u);return}}if(typeof ilib._load!=="undefined"){var p=f?[e||"resources.json"]:Utils.getLocFiles(t,e);if(n!=="json"){g.returnOne=true}Utils._callLoadData(p,l,g,ilib.bind(this,function(i){if(n==="json"){u=ilib.data[d]||{};for(var e=0;e<i.length;e++){if(typeof i[e]!=="undefined"){u=g.returnOne?i[e]:JSUtils.merge(u,i[e],o)}}if(a){ilib.data.cache[a][s]=u}r(u)}else{var e=i.length-1;while(e>-1&&!i[e]){e--}if(e>-1){if(a){ilib.data.cache[a][s]=i[e]}r(i[e])}else{r(undefined)}}}))}else{if(n==="json"){u=ilib.data[d]}if(a&&u){ilib.data.cache[a][s]=u}r(u)}}else{r(ilib.data.cache&&ilib.data.cache[a]&&ilib.data.cache[a][s])}};module.exports=Utils;